<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sección de Solicitudes</title>
</head>
<body>

<!-- Tarjeta de solicitud individual -->
<div th:fragment="solicitud-card(solicitud, showActions)" class="card solicitud-card mb-3 h-100 shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <div th:replace="~{atoms/badge :: status-badge(status=${solicitud.estado}, text=${solicitud.estado})}"></div>
            <span class="ms-2 text-muted">#<span th:text="${solicitud.id}">123</span></span>
        </div>
        <small th:text="${#temporals.format(solicitud.fecha, 'dd/MM/yyyy')}">01/01/2025</small>
    </div>
    
    <div class="card-body">
        <div class="row g-0">
            <!-- Imagen de la solicitud (si existe) -->
            <div class="col-4" th:if="${solicitud.imagen != null}">
                <img th:src="@{'/uploads/' + ${solicitud.imagen}}" alt="Imagen de solicitud" 
                     class="img-thumbnail h-100 object-fit-cover" style="max-height: 100px;">
            </div>
            
            <!-- Información de la solicitud -->
            <div th:class="${solicitud.imagen != null ? 'col-8' : 'col-12'}">
                <h5 class="card-title" th:text="${solicitud.categoria}">Categoría</h5>
                <p class="card-text mb-1">
                    <i class="bi bi-geo-alt me-1"></i>
                    <span th:text="${solicitud.direccion + ', ' + solicitud.ciudad}">Dirección</span>
                </p>
                <p class="card-text" th:if="${solicitud.descripcion}">
                    <small class="text-muted" th:text="${#strings.abbreviate(solicitud.descripcion, 50)}">Descripción</small>
                </p>
            </div>
        </div>
    </div>
    
    <div class="card-footer bg-transparent" th:if="${showActions}">
        <div class="d-flex justify-content-end gap-2">
            <a th:href="@{/user/viewsolicitude/{id}(id=${solicitud.id})}" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye me-1"></i>Ver detalles
            </a>
            <a th:if="${solicitud.estado == 'PENDIENTE'}" 
               th:href="@{/user/editsolicitude/{id}(id=${solicitud.id})}" 
               class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-pencil me-1"></i>Editar
            </a>
        </div>
    </div>
</div>

<!-- Sección de lista de solicitudes -->
<div th:fragment="solicitudes-list(solicitudes, title, emptyMessage)" class="glass-card mb-4">
    <h3 class="h5 mb-3">
        <i class="bi bi-list-ul me-2"></i>
        <span th:text="${title}">Solicitudes</span>
        <span class="badge bg-primary rounded-pill ms-2" th:text="${solicitudes.size()}">0</span>
    </h3>
    
    <div th:if="${solicitudes.empty}" class="text-center py-4">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <p class="text-muted mt-2" th:text="${emptyMessage}">No hay solicitudes</p>
    </div>
    
    <div th:unless="${solicitudes.empty}" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
        <div th:each="solicitud : ${solicitudes}" class="col">
            <div th:replace="~{::solicitud-card(solicitud=${solicitud}, showActions=true)}"></div>
        </div>
    </div>
</div>

<!-- Panel de métricas de solicitudes -->
<div th:fragment="solicitudes-metrics(activas, completadas, total)" class="glass-card mb-4">
    <h3 class="h5 mb-3">
        <i class="bi bi-graph-up me-2"></i>Métricas de Solicitudes
    </h3>
    
    <div class="row g-3 mb-3">
        <!-- Solicitudes activas -->
        <div class="col-md-4">
            <div class="card h-100 border-0 bg-light">
                <div class="card-body text-center">
                    <div class="text-warning mb-2">
                        <i class="bi bi-clock-history" style="font-size: 2rem;"></i>
                    </div>
                    <h5 class="card-title h6 mb-1">Activas</h5>
                    <p class="card-text h4 text-warning mb-0" th:text="${activas}">0</p>
                </div>
            </div>
        </div>
        
        <!-- Solicitudes completadas -->
        <div class="col-md-4">
            <div class="card h-100 border-0 bg-light">
                <div class="card-body text-center">
                    <div class="text-success mb-2">
                        <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
                    </div>
                    <h5 class="card-title h6 mb-1">Completadas</h5>
                    <p class="card-text h4 text-success mb-0" th:text="${completadas}">0</p>
                </div>
            </div>
        </div>
        
        <!-- Total solicitudes -->
        <div class="col-md-4">
            <div class="card h-100 border-0 bg-light">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="bi bi-collection" style="font-size: 2rem;"></i>
                    </div>
                    <h5 class="card-title h6 mb-1">Total</h5>
                    <p class="card-text h4 text-primary mb-0" th:text="${total}">0</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Progreso de las solicitudes -->
    <div th:if="${total > 0}">
        <div th:replace="~{atoms/progress :: labeled-progress(value=${completadas}, max=${total}, label='Progreso total', color='bg-success')}"></div>
    </div>
</div>

</body>
</html>
